angular.module("ez.dropdown",[]).constant("dropdownConfig",{openClass:"open"}).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","$document","$animate",function(a,b,c,d,e,f){var g,h=this,i=null,j=a.$new(),k=d.openClass,l=angular.noop,m=b.onToggle?c(b.onToggle):angular.noop,n=b.clickInside?!0:!1;this.open=function(a){i||(e.bind("click",o),e.bind("keydown",p)),i&&i!==a&&(i.isOpen=!1),i=a},this.close=function(a){i===a&&(i=null,e.unbind("click",o),e.unbind("keydown",p))};var o=function(a){if(i){var b=i.getToggleElement();if(!(a&&b&&b[0].contains(a.target)))return n&&a&&h.$element[0].contains(a.target)?void console.log("rteet"):void i.$apply(function(){i.isOpen=!1})}},p=function(a){27===a.which&&(i.focusToggleElement(),o())};this.init=function(d){h.$element=d,b.isOpen&&(g=c(b.isOpen),l=g.assign,a.$watch(g,function(a){j.isOpen=!!a}))},this.toggle=function(a){return j.isOpen=arguments.length?!!a:!j.isOpen},this.isOpen=function(){return j.isOpen},j.getToggleElement=function(){return h.toggleElement},j.focusToggleElement=function(){h.toggleElement&&h.toggleElement[0].focus()},j.$watch("isOpen",function(b,c){f[b?"addClass":"removeClass"](h.$element,k),b?(j.focusToggleElement(),h.open(j)):h.close(j),l(a,b),angular.isDefined(b)&&b!==c&&m(a,{open:!!b})}),a.$on("$locationChangeSuccess",function(){j.isOpen=!1}),a.$on("$destroy",function(){j.$destroy()})}]).directive("dropdown",function(){return{restrict:"EAC",controller:"DropdownController",link:function(a,b,c,d){d.init(b)}}}).directive("dropdownToggle",function(){return{restrict:"EAC",require:"?^dropdown",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.attr({"aria-haspopup":!0,"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}});