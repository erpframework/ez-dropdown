angular.module("ez.dropdown",[]).constant("dropdownConfig",{openClass:"open"}).controller("DropdownController",["$scope","$attrs","$parse","$compile","dropdownConfig","$document","$animate",function(a,b,c,d,e,f,g){var h,i=this,j=null,k=a.$new(),l=e.openClass,m=angular.noop,n=b.onToggle?c(b.onToggle):angular.noop,o=b.clickInside?!0:!1,p=!1;this.open=function(a){j||(f.bind("click",q),f.bind("keydown",r)),j&&j!==a&&(j.isOpen=!1),j=a},this.close=function(a){j===a&&(j=null,f.unbind("click",q),f.unbind("keydown",r))};var q=function(a){if(j){var b=j.getToggleElement();a&&b&&b[0].contains(a.target)||o&&a&&i.$element[0].contains(a.target)||j.$apply(function(){j.isOpen=!1})}},r=function(a){27===a.which&&(j.focusToggleElement(),q())};this.init=function(d,e){i.$element=d,i.$dropdownMenuElement=e,b.isOpen&&(h=c(b.isOpen),m=h.assign,a.$watch(h,function(a){k.isOpen=!!a}))},this.toggle=function(a){return k.isOpen=arguments.length?!!a:!k.isOpen},this.isOpen=function(){return k.isOpen},k.getToggleElement=function(){return i.toggleElement},k.focusToggleElement=function(){i.toggleElement&&i.toggleElement[0].focus()},k.$watch("isOpen",function(b,c){b&&!p&&(d(i.$dropdownMenuElement)(k,function(a){i.$element.append(a)}),p=!0),g[b?"addClass":"removeClass"](i.$element,l),b?(k.focusToggleElement(),i.open(k)):i.close(k),m(a,b),angular.isDefined(b)&&b!==c&&n(a,{open:!!b})}),a.$on("$locationChangeSuccess",function(){k.isOpen=!1}),a.$on("$destroy",function(){k.$destroy()})}]).directive("dropdown",function(){return{restrict:"EAC",controller:"DropdownController",compile:function(a){var b=a.find(".dropdown-menu").remove();return function(a,c,d,e){e.init(c,b)}}}}).directive("dropdownToggle",function(){return{restrict:"EAC",require:"?^dropdown",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.attr({"aria-haspopup":!0,"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}});