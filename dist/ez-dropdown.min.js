angular.module("ez.dropdown",[]).controller("EzDropdownCtrl",["$scope","$document","$compile",function(a,b,c){var d,e,f,g,h,i,j=($(window),!1),k=this,l=function(c){c&&a.clickInside&&g&&g.contains(c.target)?setTimeout(function(){b.one("click",l)}):(a.isOpen=!1,a.$apply())};this.show=function(){var k=$(window).width();if(j||(j=!0,c(e)(a.$parent,function(a){f=a,g=a[0],i.absolute?(d=angular.element('<span class="dropdown dropdown-absolute"></span>'),d.append(f),$("body").append(d)):d.append(f)})),i.mobileDisabled||d.hasClass("dropdown-mobile")||768>k&&(setTimeout(function(){var a=$(window).height(),b=f.outerHeight();b>a?(f.css("top",10),f.css("height",a-20)):f.css("top",(a-b)/2)}),i.noBackdrop||(h=angular.element('<div class="modal-backdrop in"></div>'),$("body").append(h),h.height($("body").height())),d.addClass("dropdown-mobile"),f.width(k-40)),i.absolute&&a.clickEvent){var m,n=a.clickEvent.clientY+$(document).scrollTop(),o=f.width();m=a.clickEvent.clientX+o>k?a.clickEvent.clientX-o:a.clickEvent.clientX,d.css({top:n+"px",left:m+"px"}),a.clickEvent=null}d.addClass("open"),"function"==typeof a.onToggle&&a.onToggle(!0),setTimeout(function(){b.one("click",l)})},this.hide=function(){d.removeClass("open"),d.hasClass("dropdown-mobile")&&(d.removeClass("dropdown-mobile"),f.css({top:"auto",left:0,width:"auto"})),"function"==typeof a.onToggle&&a.onToggle(!1),h&&h.remove(),b.off("click",l)},this.toggle=function(b){a.clickEvent=b,a.isOpen=!a.isOpen},this.init=function(b,c,f){d=b,e=c.clone(),i=f,a.toggleFn=this.toggle},a.$watch("isOpen",function(a){0!==a&&(a?k.show():k.hide())}),a.$on("$destroy",function(){h&&h.remove(),i.absolute&&d.remove(),d=e=f=g=h=null})}]).directive("dropdown",[function(){return{restrict:"EA",controller:"EzDropdownCtrl",scope:{isOpen:"=?",clickInside:"=?",clickEvent:"=?",onToggle:"=?",toggleFn:"=?",absolute:"=?"},compile:function(a){var b=a.children().last().remove();return a.addClass("dropdown"),b.addClass("dropdown-menu"),function(a,c,d,e){e.init(c,b,d)}}}}]).directive("dropdownToggle",[function(){return{restrict:"EA",require:"^dropdown",link:function(a,b,c,d){b.addClass("dropdown-toggle"),b.on("click",function(b){d.toggle(b),a.$apply()})}}}]);